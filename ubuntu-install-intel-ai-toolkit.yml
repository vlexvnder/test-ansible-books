---
- name: Install Intel AI Toolkit
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: Add Intel GPG key
      shell: wget -O- https://apt.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB \ | gpg --dearmor | sudo tee /usr/share/keyrings/oneapi-archive-keyring.gpg > /dev/null
      changed_when: false
      warn: false
    - name: Add Intel OneAPI repo
      shell: echo "deb [signed-by=/usr/share/keyrings/oneapi-archive-keyring.gpg] https://apt.repos.intel.com/oneapi all main" | sudo tee /etc/apt/sources.list.d/oneAPI.list
    - name: Install intel AI kit
      ansible.builtin.apt:
        name: intel-aikit
        state: present
        update_cache: true

- name: Set environment variables
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
  - name: Add environment variable script to profile
    copy:
      dest: "/etc/profile.d/oneapi-env-vars"
      content: |
        source /opt/intel/oneapi/setvars.sh